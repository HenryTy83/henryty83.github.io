<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />

  </head>
  <body>
  <a href="https://infinitebro.github.io/sims"> BACK </a>
  </br>
  
    <script>
    let cellSize = 15;

let auto = false;
let cells = [];

let runButton;
let alap;

function toggleAuto() {auto = !auto}

function setup() {
  createCanvas(800, 800);
  stroke(100);

  for (let i = 0; i < width / cellSize; i++) {
    let rows = [];
    for (let j = 0; j < height / cellSize; j++) {
      rows.push(false); //make an array of rows
    }

    cells.push(rows); //Make nested array of booleans corresponding to cells
  }
  
  
  //control panel
  
  runButton = createButton('RUN GENERATION');
  runButton.position(20, height);
  runButton.mousePressed(update);
  
  alap = createButton("TOGGLE AUTORUN");
  alap.position(200, height)
  alap.mousePressed(toggleAuto)
}

function getNeighbors(x, y) {
  let total = 0;

  for (let i = -1; i <= 1; i++) { //loop through neighbors
    for (let j = -1; j <= 1; j++) {
      if (cells[(x + i)][(y + j)]) {
        total++
      }
    }

  }

  if (cells[x][y]) {
    total--;
  } //ignore self
  return total;
}

function copyArr(a1) {
  let a2 = []
  
  for (let i in a1) {
    a2.push([])
    
    for (let j in a1[i]) {
      a2[i].push(a1[i][j])
    }
  }

  return a2
}

function update() {
  let newCells = copyArr(cells)

  for (let x = 1; x < cells.length - 1; x++) { //loop through
    for (let y = 1; y < cells[x].length - 1; y++) { //ignore edges
      let neighbors = getNeighbors(x, y)

      if (neighbors == 3) {
        newCells[x][y] = true
      } else if (cells[x][y] && neighbors == 2) {
        newCells[x][y] = true
      } else {
        newCells[x][y] = false;
      }
    }

  }
  cells = copyArr(newCells)
}

function draw() {
  for (let i = 1; i < cells.length - 1; i++) { //loop through
    for (let j = 1; j < cells[i].length - 1; j++) { //ignore edges
      if (cells[i][j]) {
        fill(255)
      } else {
        fill(0)
      }

      rect(i * cellSize, j * cellSize, cellSize, cellSize);

     // fill(200)
     // text(getNeighbors(i, j), i * cellSize + 5, j * cellSize + 15)
    }
  }
  
  if (auto && (frameCount % 2 == 0)) {update()} //autorun 
}

function mouseClicked() { //toggle cells that are clicked
  if (mouseX > 0 & mouseX < width & mouseY > 0 & mouseY < height) {
    let clickX = floor(mouseX / cellSize)
    let clickY = floor(mouseY / cellSize)

    cells[clickX][clickY] = !cells[clickX][clickY]; //toggle
  }
}
    
    </script>
  </body>
</html>
